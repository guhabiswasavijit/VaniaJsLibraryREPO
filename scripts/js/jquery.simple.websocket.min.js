/**
 * Minified by jsDelivr using UglifyJS v3.1.10.
 * Original file: /npm/jquery-simple-websocket@1.1.4/src/jquery.simple.websocket.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e(jQuery):e(jQuery)}(function(e){var t=function(t){if(this._opt=null,!this._isNotEmpty(t,"url"))throw new Error("Missing argument, example usage: $.simpleWebSocket({ url: 'ws://127.0.0.1:3000' }); ");this._opt=t,this._ws=null,this._reConnectTries=60,this._reConnectDeferred=null,this._dataType=this._prop(this._opt,"dataType","json"),this._listeners=[];var n=this;return this._api={connect:function(){return e.extend(n._api,n._reConnect.apply(n,[]))},isConnected:function(e){return e?(e.apply(this,[n._isConnected.apply(n,[])]),n._api):n._isConnected.apply(n,[])},send:function(t){return e.extend(n._api,n._send.apply(n,[t]))},listen:function(t){return e.extend(n._api,n._listenReconnect.apply(n,[t]))},remove:function(e){return n._remove.apply(n,[e]),n._api},removeAll:function(){return n._removeAll.apply(n,[]),n._api},close:function(){return n._close.apply(n,[]),n._reset.apply(n,[]),n._api}},this._api};return t.prototype={_createWebSocket:function(e){var t;if(!(t=e.protocols?void 0!==window.MozWebSocket?new MozWebSocket(e.url,e.protocols):window.WebSocket?new WebSocket(e.url,e.protocols):null:void 0!==window.MozWebSocket?new MozWebSocket(e.url):window.WebSocket?new WebSocket(e.url):null))throw new Error("Error, websocket could not be initialized.");return t},_bindSocketEvents:function(t,n){var r=this;e(t).bind("open",n.open).bind("close",n.close).bind("message",function(e){try{if("function"==typeof n.message)if(r._dataType&&"json"===r._dataType.toLowerCase()){var t=JSON.parse(e.originalEvent.data);n.message.call(this,t)}else if(r._dataType&&"xml"===r._dataType.toLowerCase()){var i=(new DOMParser).parseFromString(e.originalEvent.data,"text/xml");n.message.call(this,i)}else n.message.call(this,e.originalEvent.data)}catch(e){"function"==typeof n.error&&n.error.call(this,e)}}).bind("error",function(e){"function"==typeof n.error&&n.error.call(this,e)})},_webSocket:function(e){var t=this._createWebSocket(e);return this._bindSocketEvents(t,e),t},_getSocketEventHandler:function(e){var t=this;return{open:function(t){e&&e.resolve(this)},close:function(t){e&&e.rejectWith(t)},message:function(e){for(var n=0,r=t._listeners.length;n<r;n++)try{t._listeners[n].deferred.notify.apply(t,[e])}catch(e){}},error:function(n){t._ws=null;for(var r=0,i=t._listeners.length;r<i;r++)t._listeners[r].deferred.reject.apply(t,[n]);e&&e.rejectWith.apply(t,[n])}}},_connect:function(){var t=e.Deferred();if(this._ws)if(2===this._ws.readyState||3===this._ws.readyState)this._ws.close();else{if(0===this._ws.readyState)return t.promise();if(1===this._ws.readyState)return t.resolve(this._ws),t.promise()}return this._ws=this._webSocket(e.extend(this._opt,this._getSocketEventHandler(t))),t.promise()},_reset:function(){this._reConnectTries=this._prop(this._opt,"attempts",60),this._reConnectDeferred=e.Deferred()},_close:function(){this._ws&&(this._ws.close(),this._ws=null)},_isConnected:function(){return null!==this._ws&&1===this._ws.readyState},_reConnectTry:function(){var e=this;this._connect().done(function(){e._reConnectDeferred.resolve.apply(e,[e._ws])}).fail(function(t){e._reConnectTries--,e._reConnectTries>0?window.setTimeout(function(){e._reConnect.apply(e,[])},e._prop.apply(e,[e._opt,"timeout",1e4])):e._reConnectDeferred.rejectWith.apply(e,[t])})},_reConnect:function(){return this._reConnectDeferred&&"pending"===this._reConnectDeferred.state()||this._reset(),this._ws&&1===this._ws.readyState?this._reConnectDeferred.resolve(this._ws):this._reConnectTry(),this._reConnectDeferred.promise.apply(this,[])},_preparePayload:function(e){return this._opt.dataType&&"text"===this._opt.dataType.toLowerCase()?e:this._opt.dataType&&"xml"===this._opt.dataType.toLowerCase()?e:(this._opt.dataType&&this._opt.dataType.toLowerCase(),JSON.stringify(e))},_send:function(t){var n=this,r=e.Deferred();return function(e){n._reConnect.apply(n,[]).done(function(t){t.send(e),r.resolve.apply(n,[n._api])}).fail(function(e){r.rejectWith.apply(n,[e])})}(this._preparePayload(t)),r.promise()},_indexOfListener:function(e){for(var t=0,n=this._listeners.length;t<n;t++)if(this._listeners[t].listener===e)return t;return-1},_isNotEmpty:function(e,t){return void 0!==e&&null!==e&&void 0!==t&&null!==t&&""!==t&&void 0!==e[t]&&null!==e[t]&&""!==e[t]},_prop:function(e,t,n){return this._isNotEmpty(e,t)?e[t]:n},_listen:function(t){var n=this,r=e.Deferred();return n._reConnect.apply(n,[]).done(function(){r.progress(function(){t.apply(this,arguments)}),n._remove.apply(n,[t]),n._listeners.push({deferred:r,listener:t})}).fail(function(e){r.reject(e)}),r.promise()},_listenReconnect:function(t){var n=e.Deferred(),r=this;return this._listen(t).fail(function(){n.notify(arguments),r._listenReconnect.apply(r,[t])}).done(function(){n.resolve()}),n.promise()},_remove:function(e){var t=this._indexOfListener(e);-1!==t&&(this._listeners[t].deferred.resolve(),this._listeners.splice(t,1))},_removeAll:function(){for(var e=0,t=this._listeners.length;e<t;e++)this._listeners[e].deferred.resolve();this._listeners=[]}},e.extend({simpleWebSocket:function(e){return new t(e)}}),e.simpleWebSocket});
//# sourceMappingURL=/sm/ed49dfad44d1488a592fd32859ba37e1056659c560fc9012351ea6ff4e452312.map